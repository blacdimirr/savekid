<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd"
  logicalFilePath="changelog-6.12.0">

  <changeSet id="changelog-6.12.0-savekid-children" author="savekid">
    <createTable tableName="tc_savekid_children">
      <column name="id" type="bigint" autoIncrement="true">
        <constraints primaryKey="true" nullable="false" />
      </column>
      <column name="userid" type="bigint">
        <constraints nullable="false" />
      </column>
      <column name="name" type="varchar(128)"/>
      <column name="lastname" type="varchar(128)"/>
      <column name="birthdate" type="timestamp"/>
      <column name="weight" type="double"/>
      <column name="height" type="double"/>
      <column name="conditions" type="varchar(1024)"/>
      <column name="deviceid" type="bigint"/>
      <column name="status" type="varchar(32)"/>
      <column name="attributes" type="text"/>
    </createTable>

    <addForeignKeyConstraint baseTableName="tc_savekid_children"
                             baseColumnNames="userid"
                             constraintName="fk_savekid_children_userid"
                             referencedTableName="tc_users"
                             referencedColumnNames="id"
                             onDelete="CASCADE" />

    <addForeignKeyConstraint baseTableName="tc_savekid_children"
                             baseColumnNames="deviceid"
                             constraintName="fk_savekid_children_deviceid"
                             referencedTableName="tc_devices"
                             referencedColumnNames="id"
                             onDelete="SET NULL" />

    <createIndex tableName="tc_savekid_children" indexName="savekid_children_userid_idx">
      <column name="userid" />
    </createIndex>

    <createIndex tableName="tc_savekid_children" indexName="savekid_children_deviceid_idx">
      <column name="deviceid" />
    </createIndex>
  </changeSet>

</databaseChangeLog>
